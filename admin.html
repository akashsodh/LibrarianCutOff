<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§è‡§°‡§Æ‡§ø‡§® ‡§™‡•à‡§®‡§≤</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f0f2f5; margin: 20px; color: #333; }
        .container { background-color: #fff; padding: 20px 30px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); max-width: 1000px; margin: auto; }
        h1, h2 { color: #d32f2f; text-align: center; }
        #login-form { max-width: 400px; margin: 40px auto; padding: 30px; border: 1px solid #ddd; }
        #admin-panel { display: none; }
        input, select { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { padding: 10px 15px; border-radius: 4px; border: none; color: white; cursor: pointer; font-size: 16px; margin-left: 5px; }
        .btn-login { background-color: #1976d2; width: 100%; }
        .btn-logout { background-color: #c62828; width: auto; position: absolute; top: 20px; right: 20px; }
        .btn-delete { background-color: #e53935; }
        .btn-edit { background-color: #0288d1; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #37474f; color: white; }
        #error-message { color: red; text-align: center; margin-bottom: 15px; }
        
        /* Modal Styles */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: #fefefe; margin: 10% auto; padding: 30px; border: 1px solid #888; width: 80%; max-width: 500px; border-radius: 8px; }
        .close-btn { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .modal-actions { text-align: right; margin-top: 20px; }
        .btn-save { background-color: #43a047; }
        .btn-cancel { background-color: #757575; }
    </style>
</head>
<body>

    <div id="app">
        <div id="login-container">
            <div class="container" id="login-form">
                <h2>üîí ‡§è‡§°‡§Æ‡§ø‡§® ‡§≤‡•â‡§ó‡§ø‡§®</h2>
                <div id="error-message"></div>
                <input type="email" id="email" placeholder="‡§à‡§Æ‡•á‡§≤" required>
                <input type="password" id="password" placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°" required>
                <button id="loginBtn" class="btn-login">‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</button>
            </div>
        </div>

        <div id="admin-panel">
            <button id="logoutBtn" class="btn-logout">‡§≤‡•â‡§ó‡§Ü‡§â‡§ü</button>
            <div class="container">
                <h1>üõ°Ô∏è ‡§è‡§°‡§Æ‡§ø‡§® ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°</h1>
                <p>‡§Ø‡§π‡§æ‡§Ç ‡§∏‡•á ‡§Ü‡§™ ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§ï‡•ã ‡§è‡§°‡§ø‡§ü ‡§Ø‡§æ ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§</p>
                <table id="adminDataTable">
                    <thead>
                        <tr>
                            <th>‡§®‡§æ‡§Æ</th>
                            <th>‡§™‡•á‡§™‡§∞ 1</th>
                            <th>‡§™‡•á‡§™‡§∞ 2</th>
                            <th>‡§ï‡•Å‡§≤ ‡§Ö‡§Ç‡§ï</th>
                            <th>‡§∂‡•ç‡§∞‡•á‡§£‡•Ä</th>
                            <th>‡§ï‡§æ‡§∞‡•ç‡§∞‡§µ‡§æ‡§à</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeEditModal()">&times;</span>
            <h3>‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§∏‡§Ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç</h3>
            <form id="editForm">
                <input type="hidden" id="editDocId">
                <label for="studentNameEdit">‡§®‡§æ‡§Æ:</label>
                <input type="text" id="studentNameEdit" required>
                
                <label for="paper1Edit">‡§™‡•á‡§™‡§∞ 1 ‡§ï‡•á ‡§Ö‡§Ç‡§ï:</label>
                <input type="number" id="paper1Edit" min="0" max="200" required>
                
                <label for="paper2Edit">‡§™‡•á‡§™‡§∞ 2 ‡§ï‡•á ‡§Ö‡§Ç‡§ï:</label>
                <input type="number" id="paper2Edit" min="0" max="200" required>

                <label for="categoryEdit">‡§∂‡•ç‡§∞‡•á‡§£‡•Ä:</label>
                <select id="categoryEdit" required><option value="GENERAL">GENERAL</option><option value="OBC">OBC</option><option value="EWS">EWS</option><option value="MBC">MBC</option><option value="SC">SC</option><option value="ST">ST</option></select>
                
                <div class="modal-actions">
                    <button type="button" class="btn-cancel" onclick="closeEditModal()">‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
                    <button type="submit" class="btn-save">‡§¨‡§¶‡§≤‡§æ‡§µ ‡§∏‡§π‡•á‡§ú‡•á‡§Ç</button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
        // Firebase ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§®
        const firebaseConfig = {
            apiKey: "AIzaSyCMZ3phZbfW_AfnynvDU_xjFxTnlzq8qCY",
            authDomain: "librariancutoff.firebaseapp.com",
            projectId: "librariancutoff",
            storageBucket: "librariancutoff.appspot.com",
            messagingSenderId: "712490455365",
            appId: "1:712490455365:web:f2e8d06043a2ed15b1ae2c"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const studentsCollection = db.collection('students');

        // DOM Elements
        const loginContainer = document.getElementById('login-container');
        const adminPanel = document.getElementById('admin-panel');
        const editModal = document.getElementById('editModal');
        const editForm = document.getElementById('editForm');
        // ... (‡§Ö‡§®‡•ç‡§Ø DOM elements)

        // ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡•Ä ‡§≤‡•â‡§ó‡§ø‡§® ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§ï‡•Ä ‡§ú‡§æ‡§Å‡§ö
        auth.onAuthStateChanged(user => {
            if (user) {
                loginContainer.style.display = 'none';
                adminPanel.style.display = 'block';
                loadAdminData();
            } else {
                loginContainer.style.display = 'block';
                adminPanel.style.display = 'none';
            }
        });
        
        // ‡§è‡§°‡§Æ‡§ø‡§® ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
        function loadAdminData() {
            studentsCollection.orderBy('createdAt', 'desc').onSnapshot(snapshot => {
                const tableBody = document.getElementById('adminDataTable').getElementsByTagName('tbody')[0];
                tableBody.innerHTML = '';
                snapshot.forEach(doc => {
                    const student = doc.data();
                    const docId = doc.id;
                    
                    const newRow = tableBody.insertRow();
                    newRow.innerHTML = `
                        <td>${student.name}</td>
                        <td>${student.paper1}</td>
                        <td>${student.paper2}</td>
                        <td><strong>${student.totalMarks}</strong></td>
                        <td>${student.category} - ${student.area}</td>
                        <td>
                            <button class="btn-edit" onclick='openEditModal("${docId}")'>‡§è‡§°‡§ø‡§ü</button>
                            <button class="btn-delete" onclick="deleteEntry('${docId}')">‡§π‡§ü‡§æ‡§è‡§Ç</button>
                        </td>
                    `;
                });
            });
        }

        // ‡§®‡§Ø‡§æ: ‡§è‡§°‡§ø‡§ü Modal ‡§ñ‡•ã‡§≤‡•á‡§Ç
        async function openEditModal(docId) {
            try {
                const doc = await studentsCollection.doc(docId).get();
                if (!doc.exists) {
                    console.error("‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ!");
                    return;
                }
                const student = doc.data();
                
                document.getElementById('editDocId').value = docId;
                document.getElementById('studentNameEdit').value = student.name;
                document.getElementById('paper1Edit').value = student.paper1;
                document.getElementById('paper2Edit').value = student.paper2;
                document.getElementById('categoryEdit').value = student.category;
                
                editModal.style.display = 'block';
            } catch (error) {
                console.error("‡§°‡•á‡§ü‡§æ ‡§≤‡§æ‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø:", error);
            }
        }
        
        // ‡§®‡§Ø‡§æ: ‡§è‡§°‡§ø‡§ü Modal ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç
        function closeEditModal() {
            editModal.style.display = 'none';
        }

        // ‡§®‡§Ø‡§æ: ‡§¨‡§¶‡§≤‡§æ‡§µ ‡§∏‡§π‡•á‡§ú‡•á‡§Ç
        editForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const docId = document.getElementById('editDocId').value;
            const paper1 = parseInt(document.getElementById('paper1Edit').value);
            const paper2 = parseInt(document.getElementById('paper2Edit').value);

            const updatedData = {
                name: document.getElementById('studentNameEdit').value,
                paper1: paper1,
                paper2: paper2,
                totalMarks: paper1 + paper2, // ‡§ï‡•Å‡§≤ ‡§Ö‡§Ç‡§ï ‡§≠‡•Ä ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
                category: document.getElementById('categoryEdit').value,
            };

            try {
                await studentsCollection.doc(docId).update(updatedData);
                closeEditModal();
                console.log("‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡•Ä ‡§ó‡§à!");
            } catch (error) {
                console.error("‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø:", error);
                alert("‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§π‡•Å‡§à‡•§");
            }
        });
        
        // ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§π‡§ü‡§æ‡§è‡§Ç
        function deleteEntry(docId) {
            if (confirm('‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§µ‡§æ‡§ï‡§à ‡§á‡§∏ ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§ï‡•ã ‡§π‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?')) {
                studentsCollection.doc(docId).delete();
            }
        }
        
        // Window ‡§™‡§∞ ‡§ï‡§π‡•Ä‡§Ç ‡§≠‡•Ä ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§®‡•á ‡§™‡§∞ Modal ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç
        window.onclick = function(event) {
            if (event.target == editModal) {
                closeEditModal();
            }
        }
        
        // ‡§¨‡§æ‡§ï‡•Ä ‡§≤‡•â‡§ó‡§ø‡§®/‡§≤‡•â‡§ó‡§Ü‡§â‡§ü ‡§ï‡•á ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§®
        document.getElementById('loginBtn').addEventListener('click', () => { /* ... */ });
        document.getElementById('logoutBtn').addEventListener('click', () => { auth.signOut(); });
        document.getElementById('loginBtn').addEventListener('click', () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            document.getElementById('error-message').textContent = '';
            auth.signInWithEmailAndPassword(email, password).catch(error => {
                document.getElementById('error-message').textContent = '‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§à‡§Æ‡•á‡§≤ ‡§Ø‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°‡•§';
            });
        });
    </script>
</body>
</html>

